{{#if user.email}}

    <form id="form-resource-add-service" method="post" class="clearfix visible-modal" action="/resource/">

        <h1 class="modal-title">Add Service</h1>

        <div class="messages resource-form-widget"></div>

        {{> ResourceIndex/Service/edit.mustache}}

        <div class="pull-right resource-form-top-padding">
            <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
            <button type="submit" class="btn btn-inverted">Save Changes</button>
        </div>
    </form>


    <form id="form-resource-add-organization" method="post" class="clearfix visible-modal" action="/resource/">

        <h1 class="modal-title">Add Organization</h1>

        <div class="messages resource-form-widget"></div>

        {{> ResourceIndex/Organization/edit.mustache}}

        <div class="pull-right resource-form-top-padding">
            <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
            <button type="submit" class="btn btn-inverted">Save Changes</button>
        </div>
    </form>


    <form id="form-resource-add-story" method="post" class="clearfix visible-modal" action="/resource/">

        <h1 class="modal-title">Add Story</h1>

        <div class="messages resource-form-widget"></div>

        {{> ResourceIndex/Article/edit.mustache}}

        <div class="pull-right resource-form-top-padding">
            <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
            <button type="submit" class="btn btn-inverted">Save Changes</button>
        </div>
    </form>


    <form id="form-resource-add-action" method="post" class="clearfix visible-modal" action="/resource/">

        <h1 class="modal-title">Add Project</h1>

        <div class="messages resource-form-widget"></div>

        {{> ResourceIndex/Action/edit.mustache}}

        <div class="pull-right resource-form-top-padding">
            <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
            <button type="submit" class="btn btn-inverted">Save Changes</button>
        </div>
    </form>


    <form id="form-resource-add-person" method="post" class="clearfix visible-modal" action="/user/">

        <h1 class="modal-title">Add Person</h1>

        <div class="messages resource-form-widget"></div>

        {{> ResourceIndex/Person/edit.mustache}}

        <div class="pull-right resource-form-top-padding">
            <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
            <button type="submit" class="btn btn-inverted">Save Changes</button>
        </div>
    </form>


    <form id="form-resource-add-event" method="post" class="clearfix visible-modal" action="/resource/">

        <h1 class="modal-title">Add Event</h1>

        <div class="messages resource-form-widget"></div>

        {{> ResourceIndex/Event/edit.mustache}}

        <div class="pull-right resource-form-top-padding">
            <button type="submit" class="btn btn-default" data-dismiss="modal">Quit</button>
            <button type="submit" class="btn btn-inverted">Save Changes</button>
        </div>
    </form>

{{/if}}



<form id="form-resource-filter">

    <script type="application/ld+json">
        {{json scope.resources.aggregations}}
    </script>

    <div class="column-section">
        <div id="search">
            <input type="text" name="q" value="{{scope.resources.searchTerms}}" placeholder="Search the map ...">
            <button class="btn" type="submit"><i class="fa fa-search"></i></button>
        </div>
    </div>

    <div class="column-section bg-blue-paler">

        {{#ifShowFilters scope.resources.aggregations scope.resources.filters}}

            <span class="text-muted">Filter by:</span>

            {{#each scope.resources.aggregations}}

                {{#ifShowFilter . @key scope.resources.filters}}

                    <div class="dropdown resource-filter">
                        <a href="#" data-toggle="dropdown">
                            {{i18n (getField @key)}}
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu color-scheme-text layout-typo-small">
                            {{#buckets}}
                                {{#unlessIn @key key scope.resources.filters}}

                                    <li>
                                        <label class="resource-filter">
                                            <input type="checkbox" class="filter" name="filter.{{../@key}}" value="{{key}}">
                                            {{i18n key bundle=(getBundle (getField ../@key))}} ({{doc_count}})
                                        </label>
                                    </li>

                                {{/unlessIn}}
                            {{/buckets}}
                        </ul>
                    </div>

                {{/ifShowFilter}}

            {{/each}}

        {{/ifShowFilters}}

        {{#ifObjectNotEmpty scope.resources.filters}}

            {{#ifShowFilters scope.resources.aggregations scope.resources.filters}}
                <hr class="narrow" />
            {{/ifShowFilters}}

            <span class="text-muted">Current Filters:</span>

            <ul class="filters-applied">
                {{#each scope.resources.filters}}
                    {{#this}}
                        <li>
                            <label class="applied-filter">
                                <input type="checkbox" checked class="filter" name="filter.{{@key}}" value="{{.}}">
                                {{i18n (getField @key)}}: {{i18n . bundle="labels"}}
                            </label>
                        </li>
                    {{/this}}
                {{/each}}
            </ul>

          {{/ifObjectNotEmpty}}

    </div>

</form>


<div class="column-section last">

    <div class="p clearfix">

        <div class="pull-left">
            Found <span class="badge">{{scope.resources.totalItems}}</span> entities
        </div>

        <div data-app-index-switch class="pull-right">
            <a href="#list">
                <i class="fa fa-list" aria-hidden="true"></i>
                <span class="sr-only">List</span>
            </a>
            <a href="#statistic">
                <i class="fa fa-pie-chart" aria-hidden="true"></i>
                <span class="sr-only">Statistic</span>
            </a>
        </div>

    </div>

    <div class="floating-hidden">

        <ul id="list" class="resource-list truncated" data-app="link-to-fragment" data-behaviour="linkedListEntries populateMap">

            <script type="application/ld+json">
                {{{scope.resources.member}}}
            </script>
            {{#scope.resources.member}}
                <li about="{{@id}}">
                  {{>ResourceIndex/link.mustache}}
                </li>
            {{/scope.resources.member}}

        </ul>

        <ul id="statistic" class="aggregation-list">
            {{#each scope.resources.aggregations}}
                {{#ifCond (size buckets) '>' 1}}
                    <li>
                        <h2>{{i18n (getField @key)}}</h2>
                        {{pieChart . width=200 height=200 href-template="/resource/{key}"}}
                    </li>
                {{/ifCond}}
            {{/each}}
        </ul>

    </div>

</div>
