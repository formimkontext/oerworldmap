<div role="complementary" class="color-scheme-map column-large" data-view="map">
</div>

<div role="main" class="column column-small color-scheme-text bg-blue-palest">

    {{#if scope.list}}
        
        {{> ResourceIndex/read.mustache}}
        <a href="/resource/">more</a>
        
    {{else}}

        <div class="column-section">
            
            <form method="get" action="/resource/" id="search">
                
                <script type="application/ld+json">
                    {{json scope.resources.aggregations}}
                </script>
                
                <input type="text" name="q" value="{{scope.resources.searchTerms}}" placeholder="Search the map ...">
                <button class="btn" type="submit"><i class="fa fa-search"></i></button>
                
                {{#each scope.resources.aggregations}}
                    <ul class="filters" title="{{i18n (getField @key)}}">
                        {{#buckets}}
                            {{! Why do I have to use the parent @key here? }}
                            <li {{#ifIn ../@key key scope.resources.filters}}class="active"{{/ifIn}}>
                                <label>
                                    <input type="checkbox" class="filter" name="filter.{{../@key}}" value="{{key}}" {{#ifIn ../@key key scope.resources.filters}}checked{{/ifIn}}>
                                    <b>{{i18n key bundle=(getBundle (getField ../@key))}} ({{doc_count}})</b>
                                </label>
                            </li>
                        {{/buckets}}
                    </ul>
                {{/each}}
                
            </form>
            
        </div>
        
        <div class="column-section">
            {{#if scope.resources.searchTerms}}
                You searched for "{{scope.resources.searchTerms}}"
            {{else}}
                No filters set.
            {{/if}}
        </div>
        
        <div class="column-section">
            
            <p>
                Found <span class="badge">{{scope.resources.totalItems}}</span> entities
                (showing {{scope.resources.from}} - {{scope.resources.until}}) ...
            </p>
            
            {{> ResourceIndex/read.mustache}}
            
            {{#if scope.resources.firstPage}}
                <a href="{{scope.resources.firstPage}}">first</a>
            {{/if}}
            {{#if scope.resources.previousPage}}
                <a href="{{scope.resources.previousPage}}">prev</a>
            {{/if}}
            {{#if scope.resources.nextPage}}
                <a href="{{scope.resources.nextPage}}">next</a>
            {{/if}}
            {{#if scope.resources.lastPage}}
                <a href="{{scope.resources.lastPage}}">last</a>
            {{/if}}
    
        </div>
    
    {{/if}}
    
</div>